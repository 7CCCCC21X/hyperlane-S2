<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>hyperlane 第二季空投批量查询</title>

<style>
:root{
  --bg:#f9fafb;--card:#ffffff;--text:#1f2937;--sub:#6b7280;
  --primary:#2563eb;--ok:#16a34a;--err:#dc2626;--border:#e5e7eb;
}
@media(prefers-color-scheme:dark){
  :root{--bg:#111827;--card:#1f2937;--text:#f3f4f6;--sub:#94a3b8;--border:#334155}
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,"Segoe UI","PingFang SC",sans-serif;
  background:var(--bg);color:var(--text);line-height:1.5;padding:18px
}
h1{text-align:center;margin-bottom:16px;font-size:1.35rem;color:var(--primary)}
#panel{
  max-width:960px;margin:0 auto;background:var(--card);padding:16px 20px 24px;
  border:1px solid var(--border);border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.06)
}
textarea{
  width:100%;height:120px;resize:vertical;padding:10px;border:1px solid var(--border);
  border-radius:6px;font-family:monospace;font-size:.9rem
}
.btn{
  appearance:none;border:none;cursor:pointer;
  background:var(--primary);color:#fff;padding:8px 18px;font-size:.9rem;
  border-radius:6px;margin-top:10px;display:inline-block
}
.btn[disabled]{opacity:.5;cursor:not-allowed}
#progress{margin-left:12px;font-size:.85rem;color:var(--sub)}
table{
  width:100%;margin-top:20px;border-collapse:collapse;font-size:.88rem
}
th,td{padding:10px 6px;border-bottom:1px solid var(--border);white-space:nowrap;text-align:left}
th{background:var(--bg)}
.ok{color:var(--ok)}.err{color:var(--err)}
footer{margin-top:18px;font-size:.78rem;color:var(--sub);text-align:center}
</style>
</head>
<body>
<h1>hyperlane 第二季空投批量查询</h1>

<div id="panel">
  <label for="addrInput"><strong>请输入地址（每行一个）：</strong></label>
  <textarea id="addrInput" placeholder="0x1234…"></textarea>
  <button id="queryBtn" class="btn">开始查询</button>
  <span id="progress"></span>

  <table id="resultTable" style="display:none">
    <thead><tr><th>#</th><th>地址</th><th>是否符合资格</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<footer>接口来源：claim.hyperlane.foundation</footer>

<script>
const API='/api/proxy?address=';   // 通过本地代理避免 403

const btn=document.getElementById('queryBtn');
const textarea=document.getElementById('addrInput');
const prog=document.getElementById('progress');
const table=document.getElementById('resultTable');
const tbody=table.querySelector('tbody');

function showProgress(done,total){
  prog.textContent=`${done}/${total}`;
}

async function checkAddr(addr){
  try{
    const r=await fetch(API+addr.trim());
    const j=await r.json();
    return r.ok && j?.response?.isEligible===true;
  }catch{
    return null;
  }
}

btn.addEventListener('click',async()=>{
  const list=Array.from(
    new Set(textarea.value.split(/[\s,;\n\r]+/).filter(x=>/^0x[0-9a-fA-F]{40}$/.test(x)))
  );
  if(!list.length){alert('请至少输入一个有效地址');return;}

  btn.disabled=true;showProgress(0,list.length);
  tbody.innerHTML='';table.style.display='table';

  let done=0;
  for(const [i,addr] of list.entries()){
    const ok=await checkAddr(addr);
    const row=document.createElement('tr');
    row.innerHTML=`
      <td>${i+1}</td>
      <td>${addr}</td>
      <td class="${ok===true?'ok':ok===false?'err':''}">
        ${ok===true?'✅ 符合':ok===false?'❌ 不符合':'⚠️ 失败'}
      </td>`;
    tbody.appendChild(row);
    showProgress(++done,list.length);
  }
  btn.disabled=false;prog.textContent='完成';
});
</script>
</body>
</html>
